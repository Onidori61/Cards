<!DOCTYPE html>
<html class="dark" lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Poesia Líquida</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Epilogue:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "background-dark": "#0a0c12" },
                    fontFamily: { "display": ["Epilogue", "sans-serif"] }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #main-flow:has(article:hover) > article:not(:hover) {
            filter: blur(18px) grayscale(95%);
            opacity: 0.1;
            transform: scale(0.88);
        }

        .card-glow {
            transition: all 1.1s cubic-bezier(0.19, 1, 0.22, 1);
            border: 1px solid color-mix(in srgb, var(--glow-color), transparent 94%);
        }
        
        .card-glow:hover {
            border-color: var(--glow-color);
            box-shadow: 
                0 0 80px -20px color-mix(in srgb, var(--glow-color), transparent 40%),
                0 0 30px -5px var(--glow-color);
            width: 85vw;
            z-index: 20;
            opacity: 1 !important;
            filter: none !important;
            transform: scale(1) !important;
        }

        @media (min-width: 640px) { .card-glow:hover { width: 720px; } }

        .readable-text {
            text-shadow: 0 2px 15px rgba(0,0,0,0.8), 0 1px 4px rgba(0,0,0,1);
        }

        .text-mask {
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            transition: all 1s ease;
        }

        .card-glow:hover .text-mask {
            mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
        }

        .extra-dark-overlay {
            background: rgba(0, 0, 0, 0.92) !important;
        }

        #admin-panel { backdrop-filter: blur(60px); background: rgba(5, 7, 10, 0.97); }
        .admin-input { 
            background: transparent; border: none; border-bottom: 1px solid rgba(255,255,255,0.08); 
            color: white; width: 100%; outline: none; transition: 0.6s; font-weight: 200;
        }
        .admin-input:focus { border-bottom-color: white; padding-left: 12px; }

        input[type="color"] {
            -webkit-appearance: none;
            border: none; width: 50px; height: 50px; cursor: pointer; background: transparent;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border-radius: 50%; border: 1px solid #333; }
    </style>
</head>

<body class="bg-background-dark text-white font-display overflow-hidden h-screen w-screen selection:bg-white/20">

    <main id="main-flow" class="w-full h-full flex items-center overflow-x-auto no-scrollbar snap-x snap-mandatory px-[15vw] gap-12 lg:gap-28 transition-all duration-1000">
        </main>

    <div id="admin-trigger" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 opacity-5 hover:opacity-100 cursor-pointer transition-all duration-1000">
        <span class="material-symbols-outlined text-4xl tracking-[1em]">unfold_more_double</span>
    </div>

    <div id="admin-panel" class="fixed inset-0 z-[100] hidden flex-col justify-center items-center p-6">
        <div class="w-full max-w-lg space-y-12">
            <h2 class="text-[10px] tracking-[0.8em] uppercase opacity-20 text-center">Registrar Nova Memória Permanente</h2>
            <form id="poem-form" class="space-y-10">
                <input type="text" id="author" placeholder="Assinatura (Autor)" class="admin-input text-sm tracking-widest uppercase opacity-60">
                <input type="text" id="title" placeholder="Título" class="admin-input text-4xl" required autocomplete="off">
                <textarea id="content" placeholder="Texto poético..." rows="6" class="admin-input text-xl resize-none" required></textarea>
                <input type="url" id="bg-url" placeholder="URL da Imagem (Opcional)" class="admin-input text-xs opacity-30">
                <div class="flex flex-col items-center gap-4"><input type="color" id="color-picker" value="#2563eb"></div>
                <div class="flex justify-between items-center pt-6">
                    <button type="button" id="close-admin" class="text-[10px] uppercase opacity-20">Cancelar</button>
                    <button type="submit" id="submit-btn" class="text-[10px] border border-white/10 px-16 py-5 rounded-full uppercase tracking-[0.4em]">Eternizar</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8o-x6rlXvgoFepPH9AiN1r8YuFsAJGog",
            authDomain: "poesias-7fcb6.firebaseapp.com",
            projectId: "poesias-7fcb6",
            storageBucket: "poesias-7fcb6.firebasestorage.app",
            messagingSenderId: "742274128316",
            appId: "1:742274128316:web:d765af66c2126844da73b9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const flow = document.getElementById('main-flow');

        onSnapshot(query(collection(db, "poesias"), orderBy("createdAt", "desc")), (snapshot) => {
            flow.innerHTML = '';
            snapshot.forEach((doc) => {
                const data = doc.data();
                const cardId = doc.id;
                flow.insertAdjacentHTML('beforeend', `
                    <article class="relative group shrink-0 h-[75vh] w-[85vw] sm:w-[480px] snap-center rounded-[4rem] overflow-hidden card-glow shadow-2xl" style="--glow-color: ${data.glowColor}">
                        <div class="absolute inset-0 bg-cover bg-center transition-transform duration-[6s] group-hover:scale-105" style="background-image: url('${data.imageUrl || 'https://i.ibb.co/B5J7ZxGL/image.png'}')"></div>
                        <div id="overlay-${cardId}" class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-95 transition-all duration-700"></div>
                        <button onclick="document.getElementById('overlay-${cardId}').classList.toggle('extra-dark-overlay')" class="absolute top-8 right-8 z-50 w-12 h-12 rounded-full bg-black/40 backdrop-blur-xl border border-white/10 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-500 shadow-2xl">
                            <span class="material-symbols-outlined text-2xl">visibility</span>
                        </button>
                        <div class="absolute inset-0 p-12 flex flex-col justify-end translate-y-12 group-hover:translate-y-0 transition-all duration-1000">
                            <span class="text-[10px] uppercase tracking-[0.5em] opacity-50 mb-2 readable-text block">${data.author || 'Anônimo'}</span>
                            <h2 class="text-4xl font-light mb-6 tracking-tight readable-text">${data.title}</h2>
                            <div class="text-mask max-h-32 group-hover:max-h-[55vh] overflow-y-auto no-scrollbar transition-all duration-1000 overscroll-contain">
                                <p class="text-xl font-extralight text-white leading-relaxed italic readable-text">${data.content.replace(/\n/g, '<br>')}</p>
                            </div>
                        </div>
                    </article>
                `);
            });
            flow.insertAdjacentHTML('beforeend', '<div class="shrink-0 w-[25vw]"></div>');
        });

        // CORREÇÃO DO SCROLL:
        window.addEventListener('wheel', (e) => {
            // Se o mouse NÃO estiver em cima do texto interno de um card, navega horizontalmente
            const isScrollingText = e.target.closest('.overflow-y-auto');
            if (!isScrollingText) {
                flow.scrollLeft += e.deltaY;
                e.preventDefault();
            }
        }, { passive: false });

        const panel = document.getElementById('admin-panel');
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === '/') { e.preventDefault(); panel.classList.toggle('hidden'); }
            if (e.key === 'Escape') panel.classList.add('hidden');
        });

        document.getElementById('admin-trigger').onclick = () => panel.classList.toggle('hidden');
        document.getElementById('close-admin').onclick = () => panel.classList.add('hidden');

        document.getElementById('poem-form').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            btn.disabled = true;
            try {
                await addDoc(collection(db, "poesias"), {
                    author: document.getElementById('author').value,
                    title: document.getElementById('title').value,
                    content: document.getElementById('content').value,
                    imageUrl: document.getElementById('bg-url').value,
                    glowColor: document.getElementById('color-picker').value,
                    createdAt: serverTimestamp()
                });
                e.target.reset();
                panel.classList.add('hidden');
            } finally { btn.disabled = false; }
        };
    </script>
</body>
</html>
